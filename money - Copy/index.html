<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Math Quest Adventure</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            overflow: hidden;
            height: 100vh;
            margin: 0;
            padding: 0;
        }

        .game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            background: url('https://w.ladicdn.com/5dccb67118ed7f6153f61977/banner-20250624082813-kclld.png') center center/cover no-repeat;
        }

        /* Background decorations - Clouds */
        .cloud {
            position: absolute;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 50px;
            z-index: 2;
            animation: floatCloud 15s infinite ease-in-out;
        }

        .cloud::before, .cloud::after {
            content: '';
            position: absolute;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
        }

        /* Cloud 1 - Large */
        .cloud1 {
            width: 100px;
            height: 40px;
            top: 8%;
            left: 15%;
            animation-delay: 0s;
            animation-duration: 20s;
        }

        .cloud1::before {
            width: 50px;
            height: 50px;
            top: -25px;
            left: 15px;
        }

        .cloud1::after {
            width: 60px;
            height: 60px;
            top: -30px;
            right: 15px;
        }

        /* Cloud 2 - Medium */
        .cloud2 {
            width: 80px;
            height: 30px;
            top: 5%;
            right: 20%;
            animation-delay: -7s;
            animation-duration: 25s;
        }

        .cloud2::before {
            width: 35px;
            height: 35px;
            top: -18px;
            left: 12px;
        }

        .cloud2::after {
            width: 45px;
            height: 45px;
            top: -22px;
            right: 12px;
        }

        /* Cloud 3 - Small */
        .cloud3 {
            width: 60px;
            height: 25px;
            top: 12%;
            left: 50%;
            animation-delay: -15s;
            animation-duration: 18s;
        }

        .cloud3::before {
            width: 25px;
            height: 25px;
            top: -12px;
            left: 8px;
        }

        .cloud3::after {
            width: 30px;
            height: 30px;
            top: -15px;
            right: 8px;
        }

        /* Cloud 4 - Large */
        .cloud4 {
            width: 90px;
            height: 35px;
            top: 3%;
            left: 70%;
            animation-delay: -10s;
            animation-duration: 22s;
        }

        .cloud4::before {
            width: 40px;
            height: 40px;
            top: -20px;
            left: 10px;
        }

        .cloud4::after {
            width: 50px;
            height: 50px;
            top: -25px;
            right: 10px;
        }

        /* Cloud 5 - Small */
        .cloud5 {
            width: 50px;
            height: 20px;
            top: 15%;
            right: 5%;
            animation-delay: -5s;
            animation-duration: 16s;
        }

        .cloud5::before {
            width: 20px;
            height: 20px;
            top: -10px;
            left: 6px;
        }

        .cloud5::after {
            width: 25px;
            height: 25px;
            top: -12px;
            right: 6px;
        }

        /* Cloud 6 - Medium */
        .cloud6 {
            width: 70px;
            height: 28px;
            top: 10%;
            left: 30%;
            animation-delay: -20s;
            animation-duration: 24s;
        }

        .cloud6::before {
            width: 30px;
            height: 30px;
            top: -15px;
            left: 10px;
        }

        .cloud6::after {
            width: 35px;
            height: 35px;
            top: -18px;
            right: 10px;
        }

        @keyframes floatCloud {
            0% { 
                transform: translateX(-10px) translateY(0px); 
                opacity: 0.6;
            }
            25% { 
                transform: translateX(5px) translateY(-8px); 
                opacity: 0.8;
            }
            50% { 
                transform: translateX(15px) translateY(-3px); 
                opacity: 0.9;
            }
            75% { 
                transform: translateX(8px) translateY(-12px); 
                opacity: 0.7;
            }
            100% { 
                transform: translateX(-10px) translateY(0px); 
                opacity: 0.6;
            }
        }
        

        /* Character - Mobile optimized with faster movement */
        .character {
            position: absolute;
            width: 50px;
            height: 50px;
            transition: all 0.2s ease; /* Faster transition */
            z-index: 100;
            background: url('https://w.ladicdn.com/5dccb67118ed7f6153f61977/anh-mau-20250624120322-_w_7v.png') center center/contain no-repeat;
            background-size: 50px 50px;
            transform: translateX(-50%) translateY(-50%);
        }

        .character-body {
            width: 100%;
            height: 100%;
            position: relative;
            animation: idle 2s infinite ease-in-out;
        }

        /* Victory character state */
        .character.victory {
            background-image: url('https://w.ladicdn.com/5dccb67118ed7f6153f61977/anh-thang-20250624120322-vug5m.png');
        }

        @keyframes idle {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-3px); }
        }

        @keyframes celebrate {
            0% { transform: scale(1) rotate(0deg); }
            25% { transform: scale(1.1) rotate(5deg); }
            50% { transform: scale(1.2) rotate(-5deg); }
            75% { transform: scale(1.1) rotate(5deg); }
            100% { transform: scale(1) rotate(0deg); }
        }

        @keyframes confused {
            0% { transform: rotate(0deg); }
            25% { transform: rotate(5deg); }
            75% { transform: rotate(-5deg); }
            100% { transform: rotate(0deg); }
        }

        /* Game path */
        .game-path {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10;
        }

        /* Enhanced path segments with glow effect */
        .path-segment {
            position: absolute;
            height: 4px;
            background: linear-gradient(90deg, #D2691E, #CD853F);
            border-radius: 2px;
            z-index: 5;
            transition: all 0.5s ease;
        }

        .path-segment.vertical {
            width: 4px;
            height: auto;
            background: linear-gradient(180deg, #D2691E, #CD853F);
        }

        /* NEW: Path glow effect animation */
        .path-segment.glow {
            background: linear-gradient(90deg, #FFD700, #FFA500, #FFD700);
            box-shadow: 0 0 15px #FFD700, 0 0 25px #FFA500, 0 0 35px #FFD700;
            animation: pathGlow 1.5s ease-in-out;
            z-index: 15;
        }

        .path-segment.vertical.glow {
            background: linear-gradient(180deg, #FFD700, #FFA500, #FFD700);
        }

        @keyframes pathGlow {
            0% { 
                box-shadow: 0 0 5px #FFD700;
                transform: scale(1);
            }
            50% { 
                box-shadow: 0 0 20px #FFD700, 0 0 30px #FFA500, 0 0 40px #FFD700;
                transform: scale(1.2);
            }
            100% { 
                box-shadow: 0 0 5px #FFD700;
                transform: scale(1);
            }
        }

        /* Question spots - Mobile optimized */
        .question-spot {
            position: absolute;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 16px;
            color: white;
            transition: all 0.3s ease;
            border: 3px solid white;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            z-index: 20;
            transform: translateX(-50%) translateY(-50%);
        }

        .question-spot:hover {
            transform: translateX(-50%) translateY(-50%) scale(1.1);
            box-shadow: 0 6px 12px rgba(0,0,0,0.4);
        }

        .question-spot.completed {
            background: #32CD32 !important;
            animation: pulse 2s infinite;
        }

        .question-spot.current {
            animation: glow 1.5s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(50, 205, 50, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(50, 205, 50, 0); }
            100% { box-shadow: 0 0 0 0 rgba(50, 205, 50, 0); }
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 20px #FFD700; }
            50% { box-shadow: 0 0 30px #FFD700, 0 0 40px #FFD700; }
        }

        /* Area backgrounds */
        .area-forest { background: #228B22; }
        .area-hills { background: #9ACD32; }
        .area-valley { background: #4682B4; }
        .area-mountain { background: #708090; }
        .area-peak { background: #FFD700; }

        /* UI Elements - UPDATED Score Display */
        .ui-container {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* NEW: Score Display */
        .score-display {
            background: rgba(255,255,255,0.95);
            border-radius: 25px;
            padding: 15px 25px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            border: 3px solid #4169E1;
        }

        .score-text {
            font-weight: bold;
            color: #2F4F4F;
            font-size: 18px;
            text-align: center;
            margin: 0;
        }

        .score-value {
            font-size: 24px;
            color: #4169E1;
            font-weight: bold;
            margin-top: 5px;
            text-align: center;
        }

        .score-value.positive {
            color: #32CD32;
            animation: scoreIncrease 0.5s ease;
        }

        .score-value.negative {
            color: #FF4444;
            animation: scoreDecrease 0.5s ease;
        }

        @keyframes scoreIncrease {
            0% { transform: scale(1); }
            50% { transform: scale(1.3); color: #FFD700; }
            100% { transform: scale(1); }
        }

        @keyframes scoreDecrease {
            0% { transform: scale(1); }
            50% { transform: scale(0.8); }
            100% { transform: scale(1); }
        }

        .progress-bar {
            background: rgba(255,255,255,0.9);
            border-radius: 25px;
            padding: 10px 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .progress-text {
            font-weight: bold;
            color: #2F4F4F;
            margin-bottom: 5px;
        }

        .progress-fill {
            width: 200px;
            height: 10px;
            background: #E0E0E0;
            border-radius: 5px;
            overflow: hidden;
        }

        .progress-fill-bar {
            height: 100%;
            background: linear-gradient(to right, #32CD32, #228B22);
            width: 0%;
            transition: width 0.5s ease;
        }

        /* Question Modal */
        .question-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .question-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from { transform: scale(0.7) translateY(-50px); opacity: 0; }
            to { transform: scale(1) translateY(0); opacity: 1; }
        }

        .question-title {
            color: #2F4F4F;
            font-size: 20px;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .question-text {
            font-size: 24px;
            margin-bottom: 30px;
            color: #333;
            font-weight: bold;
        }

        .answer-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 30px;
        }

        .answer-btn {
            padding: 15px 20px;
            border: 2px solid #4169E1;
            background: #F0F8FF;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .answer-btn:hover {
            background: #4169E1;
            color: white;
            transform: translateY(-2px);
        }

        .answer-btn.correct {
            background: #32CD32;
            color: white;
            border-color: #228B22;
        }

        .answer-btn.incorrect {
            background: #FF6B6B;
            color: white;
            border-color: #FF4444;
        }

        .modal-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: #4169E1;
            color: white;
        }

        .btn-primary:hover {
            background: #1E90FF;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #708090;
            color: white;
        }

        .btn-secondary:hover {
            background: #556B2F;
            transform: translateY(-2px);
        }

        /* Instructions Modal */
        .instructions-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 3500;
        }

        .instructions-content {
            background: linear-gradient(135deg, #F0F8FF, #E6F3FF);
            padding: 30px;
            border-radius: 20px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            box-shadow: 0 15px 35px rgba(0,0,0,0.3);
            animation: instructionsSlideIn 0.5s ease;
            border: 3px solid #4169E1;
        }

        @keyframes instructionsSlideIn {
            from { 
                transform: scale(0.7) translateY(-50px); 
                opacity: 0; 
            }
            to { 
                transform: scale(1) translateY(0); 
                opacity: 1; 
            }
        }

        .instructions-title {
            font-size: 28px;
            color: #2F4F4F;
            margin-bottom: 25px;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }

        .instructions-list {
            text-align: left;
            margin-bottom: 30px;
            padding: 0 10px;
        }

        .instruction-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 15px;
            font-size: 16px;
            color: #333;
            line-height: 1.4;
        }

        .instruction-number {
            background: #4169E1;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
            margin-right: 12px;
            flex-shrink: 0;
            margin-top: 2px;
        }

        .instruction-text {
            flex: 1;
        }

        .instructions-icon {
            font-size: 50px;
            margin-bottom: 15px;
            animation: bounceIcon 2s infinite ease-in-out;
        }

        @keyframes bounceIcon {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .start-game-btn {
            background: linear-gradient(135deg, #32CD32, #228B22);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(50, 205, 50, 0.3);
        }

        .start-game-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(50, 205, 50, 0.4);
            background: linear-gradient(135deg, #228B22, #32CD32);
        }

        .start-game-btn:active {
            transform: translateY(0px);
        }

        /* Victory Modal - 2 types */
        .victory-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 3000;
        }

        /* High Score Victory (7-10 points) */
        .victory-content.high-score {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 15px 35px rgba(0,0,0,0.3);
            animation: victoryBounce 0.6s ease;
            border: 3px solid #FF8C00;
        }

        /* Low Score Victory (0-6 points) */
        .victory-content.low-score {
            background: linear-gradient(135deg, #87CEEB, #4682B4);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 15px 35px rgba(0,0,0,0.3);
            animation: victoryBounce 0.6s ease;
            border: 3px solid #4169E1;
        }

        @keyframes victoryBounce {
            0% { transform: scale(0.3) rotate(-10deg); opacity: 0; }
            50% { transform: scale(1.1) rotate(5deg); opacity: 1; }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }

        .trophy {
            font-size: 80px;
            margin-bottom: 20px;
            animation: trophyPush 1.5s ease-out;
        }

        .trophy.low-score {
            font-size: 60px;
        }

        @keyframes trophyPush {
            0% { 
                transform: scale(0.3) translateY(50px); 
                opacity: 0; 
            }
            60% { 
                transform: scale(1.1) translateY(-10px); 
                opacity: 1; 
            }
            100% { 
                transform: scale(1) translateY(0px); 
                opacity: 1; 
            }
        }

        .victory-title {
            font-size: 32px;
            color: #8B4513;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .victory-title.low-score {
            color: #2F4F4F;
            font-size: 28px;
        }

        .victory-text {
            font-size: 18px;
            color: #654321;
            margin-bottom: 30px;
        }

        .victory-text.low-score {
            color: #2F4F4F;
            font-size: 16px;
        }

        /* Score display in victory modal */
        .final-score {
            font-size: 24px;
            font-weight: bold;
            margin: 20px 0;
            padding: 15px;
            border-radius: 15px;
            background: rgba(255, 255, 255, 0.2);
        }

        .final-score.high-score {
            color: #8B4513;
            border: 2px solid #8B4513;
        }

        .final-score.low-score {
            color: #2F4F4F;
            border: 2px solid #2F4F4F;
        }

        /* Decorative elements */
        .tree {
            position: absolute;
            z-index: 1;
        }

        .tree-trunk {
            width: 8px;
            height: 30px;
            background: #8B4513;
            margin: 0 auto;
        }

        .tree-leaves {
            width: 25px;
            height: 25px;
            background: #228B22;
            border-radius: 50%;
            margin: -10px auto 0;
        }

        .flower {
            position: absolute;
            width: 15px;
            height: 15px;
            background: #FF69B4;
            border-radius: 50%;
            z-index: 1;
        }

        .flower::before {
            content: '';
            position: absolute;
            width: 10px;
            height: 10px;
            background: #FFD700;
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        /* Timer display with clock icon */
        .game-timer {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.95);
            border: 3px solid #4169E1;
            border-radius: 20px;
            padding: 15px 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            font-family: 'Arial', sans-serif;
            text-align: center;
            min-width: 120px;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .timer-icon {
            font-size: 24px;
            color: #4169E1;
            animation: tickTock 2s infinite ease-in-out;
        }

        .timer-label {
            font-size: 12px;
            color: #4169E1;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin: 0;
        }

        .timer-value {
            font-size: 20px;
            color: #2F4F4F;
            font-weight: bold;
            font-family: 'Courier New', monospace;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
            margin: 0;
        }

        .game-timer.running {
            border-color: #32CD32;
            background: rgba(50, 205, 50, 0.1);
        }

        .game-timer.running .timer-icon {
            color: #228B22;
            animation: tickTockRunning 1s infinite ease-in-out;
        }

        .game-timer.running .timer-label {
            color: #228B22;
        }

        .game-timer.running .timer-value {
            color: #006400;
        }

        @keyframes tickTock {
            0%, 100% { transform: rotate(-5deg); }
            50% { transform: rotate(5deg); }
        }

        @keyframes tickTockRunning {
            0%, 100% { transform: rotate(-8deg) scale(1); }
            50% { transform: rotate(8deg) scale(1.1); }
        }

        .control-btn {
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid #4169E1;
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: bold;
            color: #4169E1;
            transition: all 0.2s ease;
            user-select: none;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .control-btn:hover {
            background: #4169E1;
            color: white;
            transform: scale(1.05);
        }

        .control-btn:active {
            transform: scale(0.95);
            box-shadow: 0 1px 4px rgba(0,0,0,0.3);
        }

        .control-up {
            grid-column: 2;
            grid-row: 1;
        }

        .control-left {
            grid-column: 1;
            grid-row: 2;
        }

        .control-center {
            grid-column: 2;
            grid-row: 2;
            background: rgba(255, 215, 0, 0.9);
            border-color: #FFD700;
            color: #8B4513;
            font-size: 14px;
        }

        .control-right {
            grid-column: 3;
            grid-row: 2;
        }

        .control-down {
            grid-column: 2;
            grid-row: 3;
        }

        /* Character movement enhancement */
        .character.moving {
            transition: all 0.15s ease; /* Faster movement transition */
        }

        .character.moving-up {
            animation: moveUp 0.15s ease; /* Faster animation */
        }

        .character.moving-down {
            animation: moveDown 0.15s ease;
        }

        .character.moving-left {
            animation: moveLeft 0.15s ease;
        }

        .character.moving-right {
            animation: moveRight 0.15s ease;
        }

        @keyframes moveUp {
            0% { transform: translateY(0) scaleY(1); }
            50% { transform: translateY(-5px) scaleY(0.9); }
            100% { transform: translateY(0) scaleY(1); }
        }

        @keyframes moveDown {
            0% { transform: translateY(0) scaleY(1); }
            50% { transform: translateY(5px) scaleY(1.1); }
            100% { transform: translateY(0) scaleY(1); }
        }

        @keyframes moveLeft {
            0% { transform: translateX(0) scaleX(1); }
            50% { transform: translateX(-5px) scaleX(0.9); }
            100% { transform: translateX(0) scaleX(1); }
        }

        @keyframes moveRight {
            0% { transform: translateX(0) scaleX(1); }
            50% { transform: translateX(5px) scaleX(0.9); }
            100% { transform: translateX(0) scaleX(1); }
        }

        /* Movement speed indicator */
        .speed-indicator {
            position: fixed;
            bottom: 150px;
            right: 20px;
            background: rgba(255, 255, 255, 0.9);
            padding: 10px 15px;
            border-radius: 15px;
            border: 2px solid #4169E1;
            z-index: 1000;
            font-size: 12px;
            color: #4169E1;
            font-weight: bold;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .ui-container {
                position: fixed;
                top: 10px;
                left: 10px;
                right: 10px;
                flex-direction: row;
                justify-content: space-between;
                align-items: flex-start;
                gap: 10px;
                z-index: 1500;
            }
            
            /* Mobile Score Display - smaller and in corner */
            .score-display {
                padding: 8px 12px;
                border-radius: 15px;
                border-width: 2px;
                flex-shrink: 0;
                min-width: 70px;
            }
            
            .score-text {
                font-size: 11px;
                margin: 0;
            }
            
            .score-value {
                font-size: 16px;
                margin-top: 2px;
            }
            
            /* Mobile Progress Bar - smaller and in corner */
            .progress-bar {
                padding: 6px 10px;
                border-radius: 15px;
                flex-shrink: 0;
            }
            
            .progress-text {
                font-size: 11px;
                margin-bottom: 3px;
            }
            
            .progress-fill {
                width: 80px;
                height: 6px;
            }
            
            /* REMOVE game container padding - keep questions in original positions */
            .game-container {
                /* NO padding-top change */
            }
            
            /* Mobile Question Spots - keep original positions, just smaller */
            .question-spot {
                width: 35px;
                height: 35px;
                font-size: 14px;
                border-width: 2px;
                transform: translateX(-50%) translateY(-50%);
            }
            
            /* REMOVE specific position overrides - keep original question positions */
            
            /* Mobile Character */
            .character {
                width: 40px;
                height: 40px;
                background-size: 40px 40px;
            }
            
            /* Mobile path segments */
            .path-segment {
                height: 3px;
                border-radius: 1.5px;
            }

            .path-segment.vertical {
                width: 3px;
            }

            /* Mobile cloud adjustments */
            .cloud {
                opacity: 0.3;
            }
            
            .cloud1, .cloud4 {
                width: 40px;
                height: 16px;
            }
            
            .cloud2, .cloud3, .cloud6 {
                width: 30px;
                height: 12px;
            }
            
            .cloud5 {
                width: 25px;
                height: 10px;
            }

            /* Modal adjustments for mobile */
            .question-content {
                padding: 20px;
                margin: 10px;
                max-width: 90%;
            }
            
            .answer-options {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .answer-btn {
                padding: 12px 15px;
                font-size: 14px;
            }

            .game-timer {
                bottom: 15px;
                right: 15px;
                padding: 8px 12px;
                min-width: 70px;
                gap: 3px;
            }

            .timer-icon {
                font-size: 16px;
            }

            .timer-label {
                font-size: 9px;
            }

            .timer-value {
                font-size: 14px;
            }

            /* Instructions modal mobile */
            .instructions-content {
                padding: 20px;
                margin: 15px;
                max-width: 90%;
            }

            .instructions-title {
                font-size: 22px;
            }

            .instruction-item {
                font-size: 14px;
                margin-bottom: 12px;
            }

            .instruction-number {
                width: 20px;
                height: 20px;
                font-size: 12px;
                margin-right: 10px;
            }

            .start-game-btn {
                padding: 12px 25px;
                font-size: 16px;
            }

            /* Victory modal mobile */
            .victory-content {
                padding: 20px;
                margin: 15px;
                max-width: 90%;
            }

            .victory-title {
                font-size: 22px;
            }

            .victory-text {
                font-size: 14px;
            }

            .final-score {
                font-size: 16px;
                padding: 10px;
            }

            .trophy {
                font-size: 60px;
            }

            .trophy.low-score {
                font-size: 50px;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- Background decorations - Sky Clouds -->
        <div class="cloud cloud1"></div>
        <div class="cloud cloud2"></div>
        <div class="cloud cloud3"></div>
        <div class="cloud cloud4"></div>
        <div class="cloud cloud5"></div>
        <div class="cloud cloud6"></div>
        
        <!-- UI Container -->
        <div class="ui-container">
            <!-- NEW: Score Display instead of title -->
            <div class="score-display">
                <div class="score-text">T√≠ch ƒêi·ªÉm</div>
                <div class="score-value" id="scoreValue">0</div>
            </div>
            <div class="progress-bar">
                <div class="progress-text">Ti·∫øn ƒë·ªô: <span id="progress-text">0/15</span></div>
                <div class="progress-fill">
                    <div class="progress-fill-bar" id="progress-bar"></div>
                </div>
            </div>
        </div>

        <!-- Character -->
        <div class="character" id="character" style="top: 15%; left: 15%;">
            <div class="character-body"></div>
        </div>

        <!-- Game Path and Question Spots -->
        <div class="game-path" id="gamePath"></div>
        
        <!-- Game Timer with Clock Icon -->
        <div class="game-timer" id="gameTimer">
            <div class="timer-icon">üïê</div>
            <div class="timer-label">Th·ªùi Gian</div>
            <div class="timer-value" id="timerValue">00:00</div>
        </div>
    </div>

    <!-- Instructions Modal -->
    <div class="instructions-modal" id="instructionsModal">
        <div class="instructions-content">
            <div class="instructions-icon">üéØ</div>
            <div class="instructions-title">N·ªôi Dung</div>
            <div class="instructions-list">
                <div class="instruction-item">
                    <div class="instruction-number">1</div>
                    <div class="instruction-text">Click v√†o t·ª´ng c√¢u h·ªèi ƒë·ªÉ qu·∫£ bi di chuy·ªÉn ƒë·∫øn v√† tr·∫£ l·ªùi c√¢u h·ªèi hi·ªán ra.</div>
                </div>
                <div class="instruction-item">
                    <div class="instruction-number">2</div>
                    <div class="instruction-text">Tr·∫£ l·ªùi ƒë√∫ng ƒë·ªÉ m·ªü kho√° c√¢u ti·∫øp theo v√† ƒë∆∞·ª£c +1 ƒëi·ªÉm.</div>
                </div>
                <div class="instruction-item">
                    <div class="instruction-number">3</div>
                    <div class="instruction-text">Tr·∫£ l·ªùi sai s·∫Ω b·ªã -1 ƒëi·ªÉm. ƒê·∫°t t·ª´ 12 ƒëi·ªÉm tr·ªü l√™n ƒë·ªÉ nh·∫≠n ph·∫ßn th∆∞·ªüng ƒë·∫∑c bi·ªát!</div>
                </div>
            </div>
            <button class="start-game-btn" onclick="closeInstructions()">üöÄ B·∫Øt ƒê·∫ßu Ch∆°i</button>
        </div>
    </div>

    <!-- Question Modal -->
    <div class="question-modal" id="questionModal">
        <div class="question-content">
            <div class="question-title" id="questionTitle">C√¢u h·ªèi</div>
            <div class="question-text" id="questionText"></div>
            <div class="answer-options" id="answerOptions"></div>
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="closeQuestion()">H·ªßy</button>
            </div>
        </div>
    </div>

    <!-- Victory Modal -->
    <div class="victory-modal" id="victoryModal">
        <!-- Victory content will be dynamically created based on score -->
    </div>

    <script>
        // Game state
        let currentQuestion = 0;
        let correctAnswers = 0;
        let playerScore = 0; // NEW: Player score tracking
        let characterPosition = { x: 15, y: 85 };
        let isMovementEnabled = true;
        let movementSpeed = 4;
        let questionOpened = false;
        let isMovingToQuestion = false;
        let targetQuestionIndex = -1;
        let gameStarted = false;
        let gameStartTime = 0;
        let timerInterval = null;
        let instructionsShown = false;
        let pathSegments = [];

        let gameData = {
            questions: [
                // R·ª´ng tre (1-3) - D·ªÖ
                { 
                    question: "5 + 3 = ?", 
                    answers: {
                        A: "6",
                        B: "7", 
                        C: "8",
                        D: "9"
                    }, 
                    correct: "C", 
                    area: "forest" 
                },
                { 
                    question: "10 - 4 = ?", 
                    answers: {
                        A: "5",
                        B: "6", 
                        C: "7",
                        D: "8"
                    }, 
                    correct: "B", 
                    area: "forest" 
                },
                { 
                    question: "2 √ó 4 = ?", 
                    answers: {
                        A: "6",
                        B: "7", 
                        C: "8",
                        D: "9"
                    }, 
                    correct: "C", 
                    area: "forest" 
                },
                
                // ƒê·ªìi c·ªè (4-7) - Trung b√¨nh d·ªÖ
                { 
                    question: "15 + 8 = ?", 
                    answers: {
                        A: "21",
                        B: "22", 
                        C: "23",
                        D: "24"
                    }, 
                    correct: "C", 
                    area: "hills" 
                },
                { 
                    question: "20 - 7 = ?", 
                    answers: {
                        A: "12",
                        B: "13", 
                        C: "14",
                        D: "15"
                    }, 
                    correct: "B", 
                    area: "hills" 
                },
                { 
                    question: "6 √ó 3 = ?", 
                    answers: {
                        A: "15",
                        B: "16", 
                        C: "18",
                        D: "21"
                    }, 
                    correct: "C", 
                    area: "hills" 
                },
                { 
                    question: "24 √∑ 4 = ?", 
                    answers: {
                        A: "5",
                        B: "6", 
                        C: "7",
                        D: "8"
                    }, 
                    correct: "B", 
                    area: "hills" 
                },
                
                // Thung l≈©ng (8-11) - Trung b√¨nh
                { 
                    question: "34 + 29 = ?", 
                    answers: {
                        A: "61",
                        B: "62", 
                        C: "63",
                        D: "64"
                    }, 
                    correct: "C", 
                    area: "valley" 
                },
                { 
                    question: "50 - 18 = ?", 
                    answers: {
                        A: "30",
                        B: "31", 
                        C: "32",
                        D: "33"
                    }, 
                    correct: "C", 
                    area: "valley" 
                },
                { 
                    question: "7 √ó 8 = ?", 
                    answers: {
                        A: "54",
                        B: "55", 
                        C: "56",
                        D: "57"
                    }, 
                    correct: "C", 
                    area: "valley" 
                },
                { 
                    question: "81 √∑ 9 = ?", 
                    answers: {
                        A: "8",
                        B: "9", 
                        C: "10",
                        D: "11"
                    }, 
                    correct: "B", 
                    area: "valley" 
                },
                
                // S∆∞·ªùn n√∫i (12-14) - Kh√≥
                { 
                    question: "123 + 89 = ?", 
                    answers: {
                        A: "210",
                        B: "211", 
                        C: "212",
                        D: "213"
                    }, 
                    correct: "C", 
                    area: "mountain" 
                },
                { 
                    question: "15 √ó 12 = ?", 
                    answers: {
                        A: "170",
                        B: "175", 
                        C: "180",
                        D: "185"
                    }, 
                    correct: "C", 
                    area: "mountain" 
                },
                { 
                    question: "144 √∑ 12 = ?", 
                    answers: {
                        A: "11",
                        B: "12", 
                        C: "13",
                        D: "14"
                    }, 
                    correct: "B", 
                    area: "mountain" 
                },
                
                // ƒê·ªânh n√∫i (15) - R·∫•t kh√≥
                { 
                    question: "25¬≤ - 15¬≤ = ?", 
                    answers: {
                        A: "400",
                        B: "500", 
                        C: "600",
                        D: "175"
                    }, 
                    correct: "A", 
                    area: "peak" 
                }
            ],
            
            // Snake path positions - Move question 15 higher to avoid UI overlap
            questionPositions: [
                // Row 1 (bottom) - Left to Right - KEEP ORIGINAL
                { x: 15, y: 85 },  // 1
                { x: 35, y: 85 },  // 2
                { x: 55, y: 85 },  // 3
                { x: 75, y: 85 },  // 4
                
                // Row 2 - Right to Left (snake turn)
                { x: 75, y: 70 },  // 5
                { x: 55, y: 70 },  // 6
                { x: 35, y: 70 },  // 7
                { x: 15, y: 70 },  // 8
                
                // Row 3 - Left to Right
                { x: 15, y: 55 },  // 9
                { x: 35, y: 55 },  // 10
                { x: 55, y: 55 },  // 11
                
                // Row 4 - Continue to the right, then center for final questions
                { x: 75, y: 55 },  // 12
                { x: 75, y: 40 },  // 13
                { x: 45, y: 25 },  // 14
                { x: 45, y: 15 }   // 15 - MOVED UP from 10% to 15% to avoid UI overlap
            ]
        };

        // NEW: Update score display with animation
        function updateScore(change) {
            playerScore += change;
            const scoreElement = document.getElementById('scoreValue');
            
            // Remove existing animation classes
            scoreElement.classList.remove('positive', 'negative');
            
            // Update score text
            scoreElement.textContent = playerScore;
            
            // Add animation based on change
            if (change > 0) {
                scoreElement.classList.add('positive');
            } else if (change < 0) {
                scoreElement.classList.add('negative');
            }
            
            // Remove animation class after animation completes
            setTimeout(() => {
                scoreElement.classList.remove('positive', 'negative');
            }, 500);
        }

        // Initialize game
        function initGame() {
            createPath();
            createQuestionSpots();
            updateProgress();
            updateCharacterPosition();
            
            // Keyboard event listeners
            document.addEventListener('keydown', handleKeyPress);
            
            // Show instructions on first load
            showInstructions();
        }

        // Show instructions modal
        function showInstructions() {
            if (!instructionsShown) {
                const modal = document.getElementById('instructionsModal');
                modal.style.display = 'flex';
                instructionsShown = true;
                
                // Disable movement while instructions are shown
                isMovementEnabled = false;
            }
        }

        // Close instructions modal
        function closeInstructions() {
            const modal = document.getElementById('instructionsModal');
            modal.style.display = 'none';
            
            // Enable movement after closing instructions
            isMovementEnabled = true;
        }

        // Make closeInstructions globally accessible
        window.closeInstructions = closeInstructions;

        // Handle keyboard input
        function handleKeyPress(event) {
            if (!isMovementEnabled || questionOpened || isMovingToQuestion) return;
            
            // Don't allow movement if instructions are still shown
            const instructionsModal = document.getElementById('instructionsModal');
            if (instructionsModal.style.display === 'flex') return;
            
            switch(event.key) {
                case 'ArrowUp':
                case 'w':
                case 'W':
                    event.preventDefault();
                    moveCharacter('up');
                    break;
                case 'ArrowDown':
                case 's':
                case 'S':
                    event.preventDefault();
                    moveCharacter('down');
                    break;
                case 'ArrowLeft':
                case 'a':
                case 'A':
                    event.preventDefault();
                    moveCharacter('left');
                    break;
                case 'ArrowRight':
                case 'd':
                case 'D':
                    event.preventDefault();
                    moveCharacter('right');
                    break;
                case 'Escape':
                    if (questionOpened) {
                        closeQuestion();
                    } else if (instructionsModal.style.display === 'flex') {
                        closeInstructions();
                    }
                    break;
            }
        }

        // NEW: Create the snake path with stored references
        function createPath() {
            const path = document.getElementById('gamePath');
            const positions = gameData.questionPositions;
            pathSegments = [];
            
            for (let i = 0; i < positions.length - 1; i++) {
                const segment = document.createElement('div');
                segment.className = 'path-segment';
                segment.setAttribute('data-segment-index', i);
                
                const startX = positions[i].x;
                const startY = positions[i].y;
                const endX = positions[i + 1].x;
                const endY = positions[i + 1].y;
                
                const deltaX = endX - startX;
                const deltaY = endY - startY;
                
                if (Math.abs(deltaX) > Math.abs(deltaY)) {
                    // Horizontal segment
                    const width = Math.abs(deltaX);
                    const leftX = Math.min(startX, endX);
                    
                    segment.style.width = `${width}%`;
                    segment.style.height = '4px';
                    segment.style.left = `${leftX}%`;
                    segment.style.top = `${startY}%`;
                } else {
                    // Vertical segment
                    segment.classList.add('vertical');
                    const height = Math.abs(deltaY);
                    const topY = Math.min(startY, endY);
                    
                    segment.style.width = '4px';
                    segment.style.height = `${height}%`;
                    segment.style.left = `${startX}%`;
                    segment.style.top = `${topY}%`;
                }
                
                path.appendChild(segment);
                pathSegments.push(segment);
            }
        }

        // NEW: Function to create glow effect on path segment
        function glowPathSegment(segmentIndex) {
            if (segmentIndex >= 0 && segmentIndex < pathSegments.length) {
                const segment = pathSegments[segmentIndex];
                
                // Add glow effect
                segment.classList.add('glow');
                
                // Remove glow effect after animation completes
                setTimeout(() => {
                    segment.classList.remove('glow');
                }, 1500);
            }
        }

        // Create question spots
        function createQuestionSpots() {
            const path = document.getElementById('gamePath');
            
            gameData.questionPositions.forEach((pos, index) => {
                const spot = document.createElement('div');
                spot.className = `question-spot area-${gameData.questions[index].area}`;
                spot.style.left = `${pos.x}%`;
                spot.style.top = `${pos.y}%`;
                spot.textContent = index + 1;
                
                spot.onclick = () => {
                    console.log(`Clicked on question ${index + 1}, current question is ${currentQuestion + 1}`);
                    startMoveToQuestion(index);
                };
                
                if (index === currentQuestion) {
                    spot.classList.add('current');
                    console.log(`Question ${index + 1} is current and clickable`);
                } else if (index < currentQuestion) {
                    spot.classList.add('completed');
                } else {
                    spot.style.opacity = '0.7';
                }
                
                path.appendChild(spot);
            });
        }

        // Recreate question spots (for updates)
        function recreateQuestionSpots() {
            const path = document.getElementById('gamePath');
            const existingSpots = path.querySelectorAll('.question-spot');
            existingSpots.forEach(spot => spot.remove());
            
            createQuestionSpots();
        }

        // Update character position
        function updateCharacterPosition() {
            const character = document.getElementById('character');
            character.style.left = `${characterPosition.x}%`;
            character.style.top = `${100 - characterPosition.y}%`;
        }

        // Move character function (manual control)
        function moveCharacter(direction) {
            if (!isMovementEnabled || isMovingToQuestion) return;
            
            const character = document.getElementById('character');
            
            switch(direction) {
                case 'up':
                    characterPosition.y = Math.min(95, characterPosition.y + movementSpeed);
                    character.classList.add('moving-up');
                    break;
                case 'down':
                    characterPosition.y = Math.max(5, characterPosition.y - movementSpeed);
                    character.classList.add('moving-down');
                    break;
                case 'left':
                    characterPosition.x = Math.max(2, characterPosition.x - movementSpeed);
                    character.classList.add('moving-left');
                    break;
                case 'right':
                    characterPosition.x = Math.min(95, characterPosition.x + movementSpeed);
                    character.classList.add('moving-right');
                    break;
            }
            
            updateCharacterPosition();
            
            if (!isMovingToQuestion && !questionOpened) {
                checkNearQuestionSpot();
            }
            
            setTimeout(() => {
                character.classList.remove('moving-up', 'moving-down', 'moving-left', 'moving-right');
            }, 150);
            
            playMovementSound();
        }

        // Check if character is near a question spot and auto-open question
        function checkNearQuestionSpot() {
            const threshold = 8;
            
            gameData.questionPositions.forEach((pos, index) => {
                const distance = Math.sqrt(
                    Math.pow(characterPosition.x - pos.x, 2) + 
                    Math.pow((100 - characterPosition.y) - pos.y, 2)
                );
                
                if (distance < threshold && index === currentQuestion && !questionOpened) {
                    openQuestion(index);
                }
            });
        }

        // Start moving to question when clicked
        function startMoveToQuestion(questionIndex) {
            if (questionOpened || isMovingToQuestion) return;
            
            const instructionsModal = document.getElementById('instructionsModal');
            if (instructionsModal.style.display === 'flex') {
                return;
            }
            
            // Allow clicking on current question only
            if (questionIndex !== currentQuestion) {
                console.log(`Cannot click question ${questionIndex + 1}. Current question is ${currentQuestion + 1}`);
                return;
            }

            // Start game when clicking first question
            if (!gameStarted && questionIndex === 0) {
                startGame();
            }
            
            console.log(`Moving to question ${questionIndex + 1}`);
            targetQuestionIndex = questionIndex;
            isMovingToQuestion = true;
            isMovementEnabled = false;
            
            autoMoveToCurrentQuestion();
        }

        // Start game function
        function startGame() {
            gameStarted = true;
            gameStartTime = Date.now();
            
            const gameTimer = document.getElementById('gameTimer');
            gameTimer.classList.add('running');
            
            startTimer();
        }

        // Start timer function
        function startTimer() {
            timerInterval = setInterval(() => {
                if (gameStarted) {
                    const currentTime = Date.now();
                    const elapsedSeconds = Math.floor((currentTime - gameStartTime) / 1000);
                    updateTimerDisplay(elapsedSeconds);
                }
            }, 1000);
        }

        // Update timer display
        function updateTimerDisplay(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            const timerValue = document.getElementById('timerValue');
            
            if (timerValue) {
                timerValue.textContent = 
                    `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
            }
        }

        // Stop timer function
        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
        }

        // Auto move to current question
        function autoMoveToCurrentQuestion() {
            if (!isMovingToQuestion || targetQuestionIndex === -1) return;
            
            const targetPos = gameData.questionPositions[targetQuestionIndex];
            const targetX = targetPos.x;
            const targetY = targetPos.y;
            
            const threshold = 1.5;
            
            const dx = targetX - characterPosition.x;
            const dy = targetY - characterPosition.y;
            
            if (Math.abs(dx) < threshold && Math.abs(dy) < threshold) {
                characterPosition.x = targetX;
                characterPosition.y = targetY;
                updateCharacterPosition();
                
                isMovingToQuestion = false;
                isMovementEnabled = true;
                
                if (targetQuestionIndex > 0) {
                    glowPathSegment(targetQuestionIndex - 1);
                }
                
                setTimeout(() => {
                    if (targetQuestionIndex === currentQuestion) {
                        openQuestion(targetQuestionIndex);
                    }
                    targetQuestionIndex = -1;
                }, 1000);
                
                return;
            }
            
            const step = 2;
            if (Math.abs(dx) > Math.abs(dy)) {
                if (dx > 0) {
                    characterPosition.x = Math.min(characterPosition.x + step, targetX);
                } else {
                    characterPosition.x = Math.max(characterPosition.x - step, targetX);
                }
            } else {
                if (dy > 0) {
                    characterPosition.y = Math.min(characterPosition.y + step, targetY);
                } else {
                    characterPosition.y = Math.max(characterPosition.y - step, targetY);
                }
            }
            
            updateCharacterPosition();
            playMovementSound();
            
            setTimeout(autoMoveToCurrentQuestion, 50);
        }

        // Audio system
        const audioFiles = {
            step: null,
            correct: null,
            incorrect: null,
            popup: null,
            victory: null,
            waiting: null
        };

        // Initialize audio files
        function initAudio() {
            audioFiles.step = new Audio('sounds/step.mp3');
            audioFiles.correct = new Audio('sounds/correct.mp3');
            audioFiles.incorrect = new Audio('sounds/incorrect.mp3');
            audioFiles.popup = new Audio('sounds/popup.mp3');
            audioFiles.victory = new Audio('sounds/victory.mp3');
            audioFiles.waiting = new Audio('sounds/waiting.mp3');

            audioFiles.step.volume = 0.3;
            audioFiles.correct.volume = 0.5;
            audioFiles.incorrect.volume = 0.4;
            audioFiles.popup.volume = 0.4;
            audioFiles.victory.volume = 0.6;
            audioFiles.waiting.volume = 0.3;

            if (audioFiles.waiting) {
                audioFiles.waiting.loop = true;
            }

            Object.values(audioFiles).forEach(audio => {
                if (audio) {
                    audio.preload = 'auto';
                    audio.addEventListener('error', function() {
                        console.log(`Kh√¥ng th·ªÉ t·∫£i file √¢m thanh: ${this.src}`);
                    });
                }
            });
        }

        // Play movement sound
        function playMovementSound() {
            playSound('step');
        }

        // Play sound effects
        function playSound(type) {
            if (audioFiles[type]) {
                audioFiles[type].currentTime = 0;
                
                const playPromise = audioFiles[type].play();
                if (playPromise !== undefined) {
                    playPromise.catch(error => {
                        console.log(`L·ªói ph√°t √¢m thanh ${type}:`, error);
                    });
                }
            }
        }

        // Start waiting sound (loop)
        function startWaitingSound() {
            if (audioFiles.waiting) {
                audioFiles.waiting.currentTime = 0;
                const playPromise = audioFiles.waiting.play();
                if (playPromise !== undefined) {
                    playPromise.catch(error => {
                        console.log('L·ªói ph√°t √¢m thanh ch·ªù:', error);
                    });
                }
            }
        }

        // Stop waiting sound
        function stopWaitingSound() {
            if (audioFiles.waiting) {
                audioFiles.waiting.pause();
                audioFiles.waiting.currentTime = 0;
            }
        }

        // Open question modal
        function openQuestion(questionIndex) {
            if (questionIndex !== currentQuestion || questionOpened) return;
            
            questionOpened = true;
            
            playSound('popup');
            
            const modal = document.getElementById('questionModal');
            const question = gameData.questions[questionIndex];
            
            document.getElementById('questionTitle').textContent = `C√¢u ${questionIndex + 1}/15`;
            document.getElementById('questionText').textContent = question.question;
            
            const optionsContainer = document.getElementById('answerOptions');
            optionsContainer.innerHTML = '';
            
            Object.keys(question.answers).forEach(key => {
                const button = document.createElement('button');
                button.className = 'answer-btn';
                button.textContent = `${key}. ${question.answers[key]}`;
                button.onclick = () => selectAnswer(key);
                button.setAttribute('data-answer', key);
                optionsContainer.appendChild(button);
            });
            
            modal.style.display = 'flex';
            
            setTimeout(() => {
                startWaitingSound();
            }, 500);
        }

        // Handle answer selection - UPDATED with score system
        function selectAnswer(selectedAnswer) {
            stopWaitingSound();
            
            const question = gameData.questions[currentQuestion];
            const buttons = document.querySelectorAll('.answer-btn');
            const character = document.getElementById('character');
            
            buttons.forEach((btn) => {
                btn.onclick = null;
                const answerKey = btn.getAttribute('data-answer');
                
                if (answerKey === question.correct) {
                    btn.classList.add('correct');
                } else if (answerKey === selectedAnswer && answerKey !== question.correct) {
                    btn.classList.add('incorrect');
                }
            });
            
            setTimeout(() => {
                if (selectedAnswer === question.correct) {
                    // Correct answer
                    correctAnswers++;
                    updateScore(1); // NEW: +1 point for correct answer
                    playSound('correct');
                    
                    closeQuestion();
                    
                    setTimeout(() => {
                        const character = document.getElementById('character');
                        character.classList.add('victory');
                        character.style.animation = 'celebrate 1s ease';
                        
                        setTimeout(() => {
                            character.classList.remove('victory');
                            character.style.animation = 'idle 2s infinite ease-in-out';
                            nextQuestion();
                        }, 1500);
                    }, 100);
                    
                } else {
                    // Wrong answer
                    updateScore(-1); // NEW: -1 point for wrong answer
                    character.style.animation = 'confused 1s ease';
                    playSound('incorrect');
                    
                    setTimeout(() => {
                        character.style.animation = 'idle 2s infinite ease-in-out';
                        
                        const retryBtn = document.createElement('button');
                        retryBtn.className = 'btn btn-primary';
                        retryBtn.textContent = 'Th·ª≠ l·∫°i';
                        retryBtn.onclick = () => {
                            closeQuestion();
                            setTimeout(() => openQuestion(currentQuestion), 100);
                        };
                        
                        const modalButtons = document.querySelector('.modal-buttons');
                        modalButtons.innerHTML = '';
                        modalButtons.appendChild(retryBtn);
                        
                        const cancelBtn = document.createElement('button');
                        cancelBtn.className = 'btn btn-secondary';
                        cancelBtn.textContent = 'H·ªßy';
                        cancelBtn.onclick = closeQuestion;
                        modalButtons.appendChild(cancelBtn);
                    }, 1000);
                }
            }, 1000);
        }

        // Move to next question
        function nextQuestion() {
            console.log(`Moving from question ${currentQuestion + 1} to next question`);
            
            currentQuestion++;
            
            if (currentQuestion > 1 && currentQuestion <= gameData.questions.length) {
                glowPathSegment(currentQuestion - 2);
            }
            
            if (currentQuestion >= gameData.questions.length) {
                console.log(`Game completed! Total questions: ${gameData.questions.length}, Current: ${currentQuestion}`);
                setTimeout(showVictory, 500);
            } else {
                console.log(`Now on question ${currentQuestion + 1} of ${gameData.questions.length}`);
                updateProgress();
                recreateQuestionSpots();
                updateCharacterPosition();
            }
        }

        // Close question modal
        function closeQuestion() {
            questionOpened = false;
            
            stopWaitingSound();
            
            document.getElementById('questionModal').style.display = 'none';
            
            const modalButtons = document.querySelector('.modal-buttons');
            modalButtons.innerHTML = '<button class="btn btn-secondary" onclick="closeQuestion()">H·ªßy</button>';
        }

        // Make functions globally accessible
        window.closeQuestion = closeQuestion;
        window.claimReward = claimReward;
        window.restartGame = restartGame;

        // Update progress bar
        function updateProgress() {
            const progressText = document.getElementById('progress-text');
            const progressBar = document.getElementById('progress-bar');
            
            progressText.textContent = `${correctAnswers}/${gameData.questions.length}`;
            
            const percentage = (correctAnswers / gameData.questions.length) * 100;
            progressBar.style.width = `${percentage}%`;
        }

        // NEW: Show victory modal with different types based on score
        function showVictory() {
            playSound('victory');
            
            stopTimer();
            
            const character = document.getElementById('character');
            character.classList.add('victory');
            
            const victoryModal = document.getElementById('victoryModal');
            
            // Create victory content based on final score
            // Only 12/15, 13/15, 14/15, 15/15 (12+ points) get reward popup
            if (playerScore >= 12) {
                // High score victory (12-15 points) - with reward link
                victoryModal.innerHTML = `
                    <div class="victory-content high-score">
                        <div class="trophy">üèÜ</div>
                        <div class="victory-title">Xu·∫•t S·∫Øc!</div>
                        <div class="final-score high-score">ƒêi·ªÉm s·ªë: ${playerScore}/15</div>
                        <div class="victory-text">B·∫°n ƒë√£ ho√†n th√†nh Math Quest Adventure m·ªôt c√°ch tuy·ªát v·ªùi!<br>B·∫°n x·ª©ng ƒë√°ng nh·∫≠n ph·∫ßn th∆∞·ªüng ƒë·∫∑c bi·ªát!</div>
                        <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                            <button class="btn btn-primary" onclick="claimReward()">üéÅ Nh·∫≠n Th∆∞·ªüng</button>
                            <button class="btn btn-secondary" onclick="restartGame()">üîÑ Ch∆°i L·∫°i</button>
                        </div>
                    </div>
                `;
            } else {
                // Low score victory (0-11 points) - no reward link
                victoryModal.innerHTML = `
                    <div class="victory-content low-score">
                        <div class="trophy low-score">üéØ</div>
                        <div class="victory-title low-score">Ch√∫c M·ª´ng!</div>
                        <div class="final-score low-score">ƒêi·ªÉm s·ªë: ${playerScore}/15</div>
                        <div class="victory-text low-score">B·∫°n ƒë√£ ho√†n th√†nh Math Quest Adventure!<br>H√£y th·ª≠ l·∫°i ƒë·ªÉ ƒë·∫°t t·ª´ 12 ƒëi·ªÉm tr·ªü l√™n v√† nh·∫≠n th∆∞·ªüng nh√©!</div>
                        <div style="display: flex; gap: 15px; justify-content: center;">
                            <button class="btn btn-secondary" onclick="restartGame()">üîÑ Ch∆°i L·∫°i</button>
                        </div>
                    </div>
                `;
            }
            
            victoryModal.style.display = 'flex';
            
            createCelebrationEffects();
        }

        // Create celebration effects
        function createCelebrationEffects() {
            for (let i = 0; i < 20; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.style.position = 'fixed';
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.top = '-10px';
                    confetti.style.width = '10px';
                    confetti.style.height = '10px';
                    confetti.style.backgroundColor = ['#FFD700', '#FF69B4', '#32CD32', '#4169E1', '#FF6347'][Math.floor(Math.random() * 5)];
                    confetti.style.zIndex = '5000';
                    confetti.style.borderRadius = '50%';
                    confetti.style.pointerEvents = 'none';
                    
                    document.body.appendChild(confetti);
                    
                    const animation = confetti.animate([
                        { transform: 'translateY(-10px) rotate(0deg)', opacity: 1 },
                        { transform: `translateY(${window.innerHeight + 20}px) rotate(360deg)`, opacity: 0 }
                    ], {
                        duration: 3000 + Math.random() * 2000,
                        easing: 'ease-in'
                    });
                    
                    animation.onfinish = () => confetti.remove();
                }, i * 100);
            }
        }

        // Restart game - UPDATED to reset score
        function restartGame() {
            // Reset game state
            currentQuestion = 0;
            correctAnswers = 0;
            playerScore = 0; // NEW: Reset score
            characterPosition = { x: 15, y: 85 }; // KEEP ORIGINAL starting position
            questionOpened = false;
            isMovingToQuestion = false;
            targetQuestionIndex = -1;
            gameStarted = false;
            gameStartTime = 0;
            instructionsShown = false;
            
            stopTimer();
            
            document.getElementById('victoryModal').style.display = 'none';
            
            const character = document.getElementById('character');
            character.classList.remove('victory');
            
            const gameTimer = document.getElementById('gameTimer');
            gameTimer.classList.remove('running');
            
            document.getElementById('timerValue').textContent = '00:00';
            document.getElementById('scoreValue').textContent = '0'; // NEW: Reset score display
            
            updateProgress();
            recreateQuestionSpots();
            updateCharacterPosition();
            
            character.style.animation = 'idle 2s infinite ease-in-out';
            
            isMovementEnabled = true;
            
            showInstructions();
        }

        // Claim reward function - only for high scores
        function claimReward() {
            const rewardLink = "https://www.example.com/reward-page"; 
            
            const button = event.target;
            button.style.transform = 'scale(0.95)';
            button.innerHTML = '‚úÖ ƒêang chuy·ªÉn h∆∞·ªõng...';
            
            setTimeout(() => {
                window.open(rewardLink, '_blank');
                
                button.style.transform = 'scale(1)';
                button.innerHTML = 'üéÅ Nh·∫≠n Th∆∞·ªüng';
            }, 800);
        }

        // Initialize game when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initAudio();
            initGame();
        });

        // Touch support for mobile
        let touchStartX = 0;
        let touchStartY = 0;

        document.addEventListener('touchstart', function(e) {
            touchStartX = e.touches[0].clientX;
            touchStartY = e.touches[0].clientY;
        });

        document.addEventListener('touchend', function(e) {
            if (!isMovementEnabled || questionOpened || isMovingToQuestion) return;
            
            const instructionsModal = document.getElementById('instructionsModal');
            if (instructionsModal.style.display === 'flex') return;
            
            const touchEndX = e.changedTouches[0].clientX;
            const touchEndY = e.changedTouches[0].clientY;
            
            const deltaX = touchEndX - touchStartX;
            const deltaY = touchEndY - touchStartY;
            
            const minSwipeDistance = 30;
            
            if (Math.abs(deltaX) > Math.abs(deltaY) && Math.abs(deltaX) > minSwipeDistance) {
                if (deltaX > 0) {
                    moveCharacter('right');
                } else {
                    moveCharacter('left');
                }
            } else if (Math.abs(deltaY) > minSwipeDistance) {
                if (deltaY > 0) {
                    moveCharacter('down');
                } else {
                    moveCharacter('up');
                }
            }
        });

        // Prevent default touch behaviors
        document.addEventListener('touchmove', function(e) {
            e.preventDefault();
        }, { passive: false });
    </script>
</body>
</html>